language: php
php:
  - 5.4

branches:
  only:
    - master

env:
  global:
    # PAGODABOX_USERNAME
    - secure: "VtxoE8EYd+ZM63ls3jEg83FNCkp1PgKKRIVyB+xSdx4GbLaaPR8yuXXSsBKc\njzAMq/5DX7AkjCbGRbH5z9oiOqM785sxXTkGGV9zwYmm3iKqLcXzbhnXJQUU\neMiontrVaGlpPncvGZSZjZnbDEI4Zh5GwiwHHUqcFSMrTUX1ZQQ="
    # PAGODABOX_PASSWORD
    - secure: "Jp2Um50rI06hmTHoKiiKjUrRNKHFVfuMDQcJJZRpFpKLPBvZPjPfItToWtGa\nSMKKx2LHt1iSt5goJyRsQZJh4wRJOB/sy9rAayDAYpp8mXyQdUi3z6WF6Y6Q\n4sg5DEgZAqU3gFuKOdeB4Li6RmuF95o7H8UrnoaJXofmFi8bWp4="
    # PAGODABOX_APP
    - secure: "P0nzAlHc/1QPasC0OG8E0Co7z07zycAwRJZJs9dBhv/fH6J2vYZlYREgH0CK\ns9xhvrkmi5AfJc/0wqHb+Z1d8ZONIFbLU3R0Qt+9KvusCe6xk/2NXGvfMzE/\nrB4LyEO0pPgXSppKqfT1UBQ6zTmsGycg3OnfPVEjOgW2vjUw8NY="    

script:
  - echo 'Travis run' # tests would be here.
  # deployment from here down.
  - gem install pagoda
  - pagoda --username=$PAGODABOX_USERNAME --password=$PAGODABOX_PASSWORD --app=$PAGODABOX_APP init
  - ssh-keygen -N "" -f ~/.ssh/pagoda
  - pagoda --username=$PAGODABOX_USERNAME --password=$PAGODABOX_PASSWORD --app=$PAGODABOX_APP key:push --file=$HOME/.ssh/pagoda.pub
  - echo "Host git.pagodabox.com" >> ~/.ssh/config
  - echo "   StrictHostKeyChecking no" >> ~/.ssh/config
  - echo "   CheckHostIP no" >> ~/.ssh/config
  - echo "   UserKnownHostsFile=/dev/null" >> ~/.ssh/config
  - echo "   IdentityFile=${HOME}/.ssh/pagoda" >> ~/.ssh/config
  - echo "   IdentitiesOnly yes" >> ~/.ssh/config
  - git push --force pagoda master
  - pagoda --username=$PAGODABOX_USERNAME --password=$PAGODABOX_PASSWORD --app=$PAGODABOX_APP deploy